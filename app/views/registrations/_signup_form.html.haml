-# Small hack to have a resource set when the user loads the form for the first time
-# For some reason `resource` is nil and then the labels won't be correct
- user = resource.nil? ? User.new : resource

= minimal_form_for user, as: resource_name, url: registration_path(resource_name), wrapper: :vertical_form do |f|

  .field-group
    %h3= t('.user_info_section')
    = f.hidden_field :locale, value: I18n.locale
    = f.input :email, required: true
    = f.fields_for :profile do |p|
      = p.input :full_name, required: true
      .form-group
        = select_tag :service_usage_select, options_for_select(User.usage_collection), prompt: t(".service_usage_select"), class: 'form-control'
      = p.input :service_usage, as: :string, required: false

  .field-group
    %h3= t('.webconf_section')
    = f.input :username, required: true, wrapper: :vertical_input_group do
      - if webconf_url_prefix.length <= 35
        - prepend_text = webconf_url_prefix
      - else
        - prepend_text = "/#{webconf_path_prefix}"
      = content_tag :span, prepend_text, class: "input-group-addon"
      = f.input_field :username, class: "form-control", placeholder: t("activerecord.attributes.user.username")
    = disable_autocomplete_for('user[username]')
    .webconf-observation= t('.webconf_id_tip')

  .field-group
    %h3= t('.password_section')
    = disable_autocomplete_for('user[password]', 'password')
    = f.input :password, required: true
    = f.input :password_confirmation, required: true

  .alert.alert-gray
    = icon_info
    = t('.confirmation')

  .field-group
    = captcha_tags

  .form-accept-terms.field-group
    = check_box_tag :terms, 1, false, as: :boolean
    = label_tag :terms, t('.terms').html_safe

  = f.button :wrapped, value: t(".register")
